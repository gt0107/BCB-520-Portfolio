---
title: "BCB 520 - Midterm Portfolio Post"
subtitle: "In Progress"
author: "Geraline Trossi-Torres"
date: "2024-03-18"
categories: [Midterm, DataViz, Visualization]
image: Profile4.jpg
code-fold: true
code-tools: true
description: "In Progress"
---

## PURPOSE

In this blog post, you will get more insight into how much federal funding is awarded at the University of Idaho (UI) by the following federal agencies: the Department of Energy (DOE), the US Department of Agriculture (NIFA), the National Institute of Health (NIH), and National Science Foundation (NSF). These agencies provide funding to different types/ areas of research (agriculture, engineering, biology, computer science, physics, social science, etc.), and we want to determine how much money is going into these types of research. We also are looking at the timeline trend of how much funding is awarded at UI compared to previous years and if there's any positive or negative impact. We can also see the longevity of the funding, like how long that funding is available. We also did a comparison between institutions in how much funding is awarded across institutions, we compared UI with  Boise State University and Idaho State University. This information will provide a general understanding of where UI stands and how it competes with other institutions in acquiring federal funding from those agencies. By the end of this blog post, you will understand the distribution of awarded federal funding across these agencies.

## DATA
The data was acquired by the database of each of these federal agencies, the data is open for the public and you can obtain information of currently active/past research projects by institution and principal investigator (PI).

### Data Dictionary

This data dictionary provides an overview of the variables that was used in each individual dataset, along with their descriptions and data types. This will give us more understanding of the structure of the data that was selected and will facilitate in the analysis and the interpretation of how UI stands in means of funding from each individual federal agency.
 
```{r}
library(readxl)
DataDictionary <- read_xlsx("Data Dictionary.xlsx")

knitr::kable(head(DataDictionary ))
```

### Summary of Data Sources

Each of these data sets will provide information in how much money is entering UI. This provide insight, where these funds is being used, like these awarded funding are used to support the activities that are conducted to support the research project, which this is also includes the funding for faculty salaries, graduate student stipends, equipment purchases, and other research-related expenses. This will also help the UI administration to have an overall general idea how these resources are being used and how is benefiting the institution.

::: callout-note
## NOTE

Some of these data sets are long and extensive and it was shorten, for your benefit to be able to visualize how the data table looks like.
:::

#### DOE Awards Data (DOEawards.xlsx)
This dataset contains information about awards provided by the Department of Energy (DOE).

```{r, message=FALSE}
suppressPackageStartupMessages(library(readxl))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(tidyverse))
```

```{r, message=FALSE, warning=FALSE}
library(readxl)
library(dplyr)
library(tidyverse)

DOEawardsUI <- read_xlsx("DOEawards.xlsx", .name_repair = "minimal")

DOEawardsUI <- read_xlsx("DOEawards.xlsx")

DOEUI_General <- DOEawardsUI %>% 
  dplyr::filter(Institution == 'Regents of the University of Idaho')

DOEUI_New_Awards <- DOEUI_General %>%
  select(Title, Institution, PI, Status, `Action Type`, `Program Office`, `Start Date`, `End Date`, `Most Recent Award Date`, `Amount Awarded to Date`)

knitr::kable(head(DOEUI_New_Awards))

library(readr)
DOEawardsUI <- suppressMessages(read_xlsx("DOEawards.xlsx"))
```

#### USDA to UI Awards Data (USDAtoUI.csv): 
This dataset includes awards data related to the University of Idaho (UI) received from the U.S. Department of Agriculture (USDA).

```{r, message=FALSE}
suppressPackageStartupMessages(library(readxl))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(tidyverse))
```

```{r}
library(tidyverse)
library(readxl)
library(knitr)

USDAUI  <- read.csv("USDAtoUI.csv")
knitr::kable(head(USDAUI))

library(dplyr)

# Assuming 'Date' is the column containing the grant date information
start_date <- as.Date("2021-01-01")
end_date <- as.Date("2024-03-15")

UIgrants_recent_grantsUSDA <- USDAUI %>% 
  filter(Award.Date >= start_date & Award.Date <= end_date) %>%
  arrange(desc(Award.Date))

library(dplyr)

start_date <- as.Date("2024-01-01")
end_date <- as.Date("2024-12-31")

UIgrants_2024_grantsUSDA <- UIgrants_recent_grantsUSDA %>% 
  filter(Award.Date >= start_date & Award.Date <= end_date) %>%
  summarise(UIgrants_2024_grantsUSDA = n())
```

#### NSF UI Awards Data (NSFUI_2.xlsx)
This dataset consists of awards data from the National Science Foundation (NSF) received by the University of Idaho (UI).

```{R}
library(readxl)
library(dplyr)
library(tidyverse)
library(knitr) # Ensure knitr is explicitly loaded for kable()

# Reading the dataset from an Excel file
NSFUIAwardsActive <- read_xlsx("NSFUI_2.xlsx")

# Selecting specific columns, ensure there are no leading or trailing spaces in column names
NSFUI_New_Awards_Specific <- NSFUIAwardsActive %>%
  select(Title, NSFOrganization, StartDate, LastAmendmentDate, EndDate, AwardedAmountToDate)

# Displaying the first few rows in a table format
knitr::kable(head(NSFUI_New_Awards_Specific))

```

#### NIH UI Awards Data (NIHUI_2.xlsx)
This dataset contains information about awards received by the University of Idaho (UI) from the National Institutes of Health (NIH).

```{R}
library(readxl)
library(dplyr)
library(tidyverse)

NIHUIAwardsActive <- read_xlsx("NIHUI_2.xlsx")

NIHUI_New_Awards_Specific <- NIHUIAwardsActive %>%
  select('Project Title', 'Administering IC', 'Award Notice Date', `Opportunity Number`, `Project Number`, `Project Start Date`, `Project End Date`, `Budget Start Date`, `Budget End Date`, 'Total Cost', 'Total Cost (Sub Projects)', 'Funding IC(s)', 'Direct Cost IC', 'InDirect Cost IC', 'Total Cost IC')

knitr::kable(head(NIHUI_New_Awards_Specific))

```

## DATA VISUALIZATION AND ANALYSIS

The following questions is going to help us visualize UI's longevity and distribution of the university's portfolio of current and past awards. It will helps us identify if there are awards that are nearing their expiration.Also, will be doing a comparison with UI between two peer institutions: Boise State University and Idaho State University. This will help us understand UI's performance in securing federal funding, and how those it measures up against to the other institutions within the same region. 

### QUESTION 1

Provide a visualization that shows our active awards from each sponsor. I need to see their start date and end date, the amount of the award, and the name of the Principal Investigator. Iâ€™m really interested in seeing how far into the future our current portfolio will exist. Are there a bunch of awards about to expire? Are there a bunch that just got funded and will be active for a while? Does this vary across sponsors?

```{r}
library(readxl)
library(dplyr)
library(ggplot2)

Q1_Data <- read_xlsx("Q1_Compilled_Data.xlsx")

# Convert StartDate and EndDate to Date objects
Q1_Data$StartDate <- as.Date(Q1_Data$StartDate, format = "%m/%d/%Y")
Q1_Data$EndDate <- as.Date(Q1_Data$EndDate, format = "%m/%d/%Y")

# Filter out rows with NA values in StartDate or EndDate
Q1_Data <- Q1_Data[complete.cases(Q1_Data$StartDate, Q1_Data$EndDate), ]

# Create the Gantt chart
# Create the Gantt chart
ggplot(Q1_Data, aes(y = Sponsor, x = StartDate, xend = EndDate, yend = Sponsor)) +
  geom_segment(size = 10, color = "black") +  # Use linewidth instead of size
  scale_x_date(date_breaks = "1 year", date_labels = "%Y", limits = c(as.Date("2021-01-01"), as.Date("2029-01-01"))) +
  labs(title = "Active Awards Timeline",
       x = "Timeline",
       y = "Sponsor") +
  theme_minimal() +
  theme(legend.position = "bottom")
```

### QUESTION 2

What is the proportional representation of new awards to the UI from these various sources over the past 5 to 10 years? Are there any trends that are encouraging or discouraging?

```{r}
#DOE

library(readxl)
library(dplyr)
library(lubridate)

# Read the Excel file
DOEawardsUI_Dates <- read_xlsx("DOEawards.xlsx")

filtered_data_UI_DOE <- DOEawardsUI_Dates %>%
  filter(Institution == 'Regents of the University of Idaho')

#USDA

USDAawardsUI_Dates <- read.csv("USDAtoUI.csv")

# Assuming the start date column is named "Start_Date"
five_years_ago <- Sys.Date() - years(5)  # Calculate the date 5 years ago

# Filter the data to include only awards that started 5 years ago or later
filtered_data_UI_5y_USDA <- USDAawardsUI_Dates %>%
  filter(Award.Date >= five_years_ago)

# Assuming the start date column is named "Start_Date"
ten_years_ago <- Sys.Date() - years(10)  # Calculate the date 5 years ago

# Filter the data to include only awards that started 5 years ago or later
filtered_data_UI_10y_USDA <- USDAawardsUI_Dates %>%
  filter(Award.Date >= ten_years_ago)
```

### QUESTION 3

How is UI performing with these sponsors when compared to the following peer institutions?

::: callout-note
## NOTE

The following data sets are from the institutions of Boise State University and Idaho State University, the data set from University of Idaho is already been presented at the beginning of the blog post. Also, these data sets are long and extensive and it was shorten, for your benefit to be able to visualize how the data table looks like.
:::

#### Boise State University

**Department of Agriculture (NIFA)**

```{r}
library(tidyverse)
library(readxl)
library(knitr)

BSUUSDA  <- read.csv("USDABSU.csv")
knitr::kable(head(BSUUSDA,4))
```

**Department of Energy**
```{r}
library(readxl)
library(dplyr)

DOEawardsBSU <- read_xlsx("DOEawards.xlsx")

DOEBSU_General <- DOEawardsBSU %>% 
  dplyr::filter(Institution == 'Boise State University')

DOEBSU_New_Awards <- DOEBSU_General %>%
  select(Title, Institution, PI, Status, `Action Type`, `Program Office`, `Start Date`, `End Date`, `Most Recent Award Date`, `Amount Awarded to Date`)

knitr::kable(head(DOEBSU_New_Awards,4))
library(tidyverse)
```

**National Institutes of Health (NIH)**

```{R}
library(readxl)
library(dplyr)
library(tidyverse)

NIHBSUAwardsActive <- read_xlsx("NIHBSU_2.xlsx")

NIHBSU_New_Awards_Specific <- NIHBSUAwardsActive %>%
  select('Project Title', 'Administering IC', 'Award Notice Date', `Opportunity Number`, `Project Number`, `Project Start Date`, `Project End Date`, `Budget Start Date`, `Budget End Date`, 'Total Cost', 'Total Cost (Sub Projects)', 'Funding IC(s)', 'Direct Cost IC', 'InDirect Cost IC', 'Total Cost IC')

knitr::kable(head(NIHBSU_New_Awards_Specific,4))
```

**National Science Foundation (NSF)**

```{R}
library(readxl)
library(dplyr)
library(tidyverse)
library(knitr) # Ensure knitr is explicitly loaded for kable()

# Reading the dataset from an Excel file
NSFBSUAwardsActive <- read_xlsx("NSFBSU_2.xlsx")

# Selecting specific columns, ensure there are no leading or trailing spaces in column names
NSFBSU_New_Awards_Specific <- NSFBSUAwardsActive %>%
  select(Title, NSFOrganization, StartDate, LastAmendmentDate, EndDate, AwardedAmountToDate)

# Displaying the first few rows in a table format
knitr::kable(head(NSFBSU_New_Awards_Specific,4))
```

#### Idaho State University

**Department of Energy**
```{r}
library(readxl)
library(dplyr)
library(tidyverse)

DOEaward <- read_xlsx("DOEawards.xlsx")

DOEIDAHOSATTE_General <- DOEaward %>% 
  dplyr::filter(Institution == 'Idaho State University')

DOEDAHOSATTE_New_Awards <- DOEIDAHOSATTE_General %>%
  select(Title, Institution, PI, Status, `Action Type`, `Program Office`, `Start Date`, `End Date`, `Most Recent Award Date`, `Amount Awarded to Date`)

knitr::kable(head(DOEDAHOSATTE_New_Awards,4))

```

**Department of Agriculture (NIFA)**

```{r}
library(tidyverse)
library(readxl)
library(knitr)

ISUUSDA  <- read.csv("USDAISU.csv")
knitr::kable(head(ISUUSDA,4))
```

**National Institutes of Health (NIH)**

```{R}
library(readxl)
library(dplyr)
library(tidyverse)

NIHISUAwardsActive <- read_xlsx("NIHISU_2.xlsx")

NIHISU_New_Awards_Specific <- NIHISUAwardsActive %>%
  select('Project Title', 'Administering IC', 'Award Notice Date', `Opportunity Number`, `Project Number`, `Project Start Date`, `Project End Date`, `Budget Start Date`, `Budget End Date`, 'Total Cost', 'Total Cost (Sub Projects)', 'Funding IC(s)', 'Direct Cost IC', 'InDirect Cost IC', 'Total Cost IC')

knitr::kable(head(NIHISU_New_Awards_Specific,4))
```

**National Science Foundation (NSF)**

```{R}
library(readxl)
library(dplyr)
library(tidyverse)
library(knitr) # Ensure knitr is explicitly loaded for kable()

# Reading the dataset from an Excel file
NSFISUAwardsActive <- read_xlsx("NSFISU_2.xlsx")

# Selecting specific columns, ensure there are no leading or trailing spaces in column names
NSFISU_New_Awards_Specific <- NSFISUAwardsActive %>%
  select(Title, NSFOrganization, StartDate, LastAmendmentDate, EndDate, AwardedAmountToDate)

# Displaying the first few rows in a table format
knitr::kable(head(NSFISU_New_Awards_Specific,4))
```

#### Data Comparison of Awarded Money

The following data presents how much money is coming to these institutions, and can provide insights into UI's competitiveness and standing within its peer group.

**USDA**

```{R}
# COMPARISON BETWEEEN USDA - AWARD MONEY

library(readxl)

USDA_Compare_Data <- read_xlsx("USDA_Combined_Data_Recent_Awards.xlsx")

library(dplyr)
library(ggplot2)

library(dplyr)

# Calculate total award money for each institution
USDA_total_award_money <- USDA_Compare_Data %>%
  group_by(Grantee_Name) %>%
  summarise(USDA_total_award_money = sum(Award_Dollars))

library(ggplot2)

ggplot(USDA_total_award_money, aes(x = Grantee_Name, y = USDA_total_award_money)) +
  geom_bar(stat = "identity", fill = "blue") +
  ggtitle("Total of Award Money from USDA Grants") +
  xlab("") +
  ylab("Total Award Money") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        axis.text.y = element_text(size = 12),
        plot.title = element_text(hjust = 0.5)) +  # Corrected position of plot title
  scale_y_continuous(labels = scales::number_format(scale = 1e-6, suffix = "M"))

```

**Figure 1:**

**DOE**
```{r}
# COMPARISON BETWEEEN DOE - AWARD MONEY
library(dplyr)
library(ggplot2)
library(readxl)

DOE_Compare_Data <- read_xlsx("DOEawards_Combined_Data.xlsx")

# Calculate total award money for each institution
DOE_total_award_money <- DOE_Compare_Data %>%
  group_by(Institution) %>%
  summarise(DOE_total_award_money = sum(`Amount Awarded to Date`))

# Colors
my_colors <- c("Boise State University" = "orange", "Idaho State University" = "black", "Regents of the University of Idaho" = "gold")

library(ggplot2)

ggplot(DOE_total_award_money, aes(x = Institution, y = DOE_total_award_money)) +
  geom_bar(stat = "identity", position = "dodge", fill = my_colors)  +
  ggtitle("Total of Award Money from USDA Grants") +
  xlab("") +
  ylab("Total Award Money") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 12),  # Adjust size of x-axis labels
        axis.text.y = element_text(size = 12),  # Adjust size of y-axis labels
        legend.text = element_text(size = 12),  # Adjust size of legend text
        plot.title = element_text(hjust = 0.5, size = 14)) +  # Adjust size of plot title
  scale_y_continuous(labels = scales::number_format(scale = 1e-6, suffix = "M"))
```

**Figure 2:**

**NSF**

```{r}
# COMPARISON BETWEEEN NSF - AWARD MONEY - NO APARECE LA DATA
library(dplyr)
library(ggplot2)
library(readxl)

NSF_Compare_Data <- read_xlsx("NSF_Combined_Data.xlsx")

library(dplyr)

# Filter the data for each institution
UI_NSF_data <- NSF_Compare_Data %>%
  filter(Organization == "Regents of the University of Idaho")

BSU_NSF_data <- NSF_Compare_Data %>%
  filter(Organization == "Boise State University")

ISU_NSF_data <- NSF_Compare_Data %>%
  filter(Organization == "Idaho State University")

# Calculate the duration of grants for each institution
# Convert "Start Date" and "End Date" columns to date objects
#UI

# Convert AwardedAmountToDate column to numeric
NSF_Compare_Data$AwardedAmountToDate <- as.numeric(gsub("\\$", "", NSF_Compare_Data$AwardedAmountToDate))

# Calculate total award money for each institution
NSF_total_award_money <- NSF_Compare_Data %>%
  group_by(Organization) %>%
  summarise(NSF_total_award_money = sum(AwardedAmountToDate, na.rm = TRUE))

# Calculate total award money for each institution
NSF_total_award_money <- NSF_Compare_Data %>%
  group_by(Organization) %>%
  summarise(NSF_total_award_money = sum(AwardedAmountToDate))

# Colors
my_colors <- c("Boise State University" = "orange", "Idaho State University" = "black", "Regents of the University of Idaho" = "gold")

library(ggplot2)

ggplot(NSF_total_award_money, aes(x = Organization, y = NSF_total_award_money)) +
  geom_bar(stat = "identity", position = "dodge", fill = my_colors)  +
  ggtitle("Total of Award Money from NSF Grants") +
  xlab("") +
  ylab("Total Award Money") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 12),  # Adjust size of x-axis labels
        axis.text.y = element_text(size = 12),  # Adjust size of y-axis labels
        legend.text = element_text(size = 12),  # Adjust size of legend text
        plot.title = element_text(hjust = 0.5, size = 14)) +  # Adjust size of plot title
  scale_y_continuous(labels = scales::number_format(scale = 1e-6, suffix = "M"))
```

**Figure 3:**

**NIH**

```{r}
# COMPARISON BETWEEEN NIH - AWARD MONEY - CALCULATED THE AVERAGE INSTEAD THE TOTAL AMMOUNT
library(dplyr)
library(ggplot2)

library(readxl)

NIH_Compare_Data <- read_xlsx("NIH_Combined_Data.xlsx")

# Calculate total award money for each institution, removing NA values in TotalCost

NIH_total_award_money <- NIH_Compare_Data %>%
  group_by(OrganizationName) %>%
  summarise(NIH_total_award_money = sum(TotalCost, na.rm = TRUE))

# Colors

my_colors_3 <- c("BOISE STATE UNIVERSITY" = "orange", "IDAHO STATE UNIVERSITY" = "black", "UNIVERSITY OF IDAHO" = "gold")

library(ggplot2)

ggplot(NIH_total_award_money, aes(x = OrganizationName, y = NIH_total_award_money)) +
  geom_bar(stat = "identity", position = "dodge", fill = my_colors_3)  +
  ggtitle("Total of Award Money from NIH Grants") +
  xlab("") +
  ylab("Total Award Money") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 12),  # Adjust size of x-axis labels
        axis.text.y = element_text(size = 12),  # Adjust size of y-axis labels
        legend.text = element_text(size = 12),  # Adjust size of legend text
        plot.title = element_text(hjust = 0.5, size = 14)) +  # Adjust size of plot title
  scale_y_continuous(labels = scales::number_format(scale = 1e-6, suffix = "M"))
```

**Figure 4:**

#### Data Comparison of Grant Duration

**DOE**

```{r}
# COMPARISON BETWEEEN DOE - Grant Duration

library(readxl)

DOE_Compare_Data <- read_xlsx("DOEawards_Combined_Data.xlsx")

library(dplyr)

# Assuming 'start_date' and 'end_date' are columns containing the start and end dates of the grants,
# and 'institution' is a column indicating the institution for each grant

# Filter the data for each institution
UI_data <- DOE_Compare_Data %>%
  filter(Institution == "Regents of the University of Idaho")

BSU_data <- DOE_Compare_Data %>%
  filter(Institution == "Boise State University")

ISU_data <- DOE_Compare_Data %>%
  filter(Institution == "Idaho State University")

# Calculate the duration of grants for each institution
# Convert "Start Date" and "End Date" columns to date objects
UI_data <- UI_data %>%
  mutate(`Start Date` = as.Date(`Start Date`, format = "%m/%d/%Y"),
         `End Date` = as.Date(`End Date`, format = "%m/%d/%Y"))

# Assuming 'grant_duration' is in days
UI_data <- UI_data %>%
  mutate(grant_duration = `End Date` - `Start Date`)

UI_data <- UI_data %>%
  mutate(grant_duration_years = as.numeric(grant_duration) / 365.25)

# BSU
BSU_data <- BSU_data %>%
  mutate(`Start Date` = as.Date(`Start Date`, format = "%m/%d/%Y"),
         `End Date` = as.Date(`End Date`, format = "%m/%d/%Y"))

# Assuming 'grant_duration' is in days
BSU_data <- BSU_data %>%
  mutate(grant_duration = `End Date` - `Start Date`)

BSU_data <- BSU_data %>%
  mutate(grant_duration_years = as.numeric(grant_duration) / 365.25)

# ISU
ISU_data <- ISU_data %>%
  mutate(`Start Date` = as.Date(`Start Date`, format = "%m/%d/%Y"),
         `End Date` = as.Date(`End Date`, format = "%m/%d/%Y"))

# Assuming 'grant_duration' is in days
ISU_data <- ISU_data %>%
  mutate(grant_duration = `End Date` - `Start Date`)

ISU_data <- ISU_data %>%
  mutate(grant_duration_years = as.numeric(grant_duration) / 365.25)

# Visualization

library(dplyr)

# Assuming UI_data contains the grant duration information for one institution
# and other_datasets contain the grant duration information for the other institutions

# Combine datasets
combined_data <- bind_rows(UI_data, BSU_data, ISU_data)

# Colors

my_colors <- c("Boise State University" = "orange", "Idaho State University" = "black", "Regents of the University of Idaho" = "gold")

# Plotting grant duration as a bar graph
# Plotting grant duration as a bar graph
library(ggplot2)

ggplot(combined_data, aes(x = Institution, y = grant_duration_years, fill = Institution)) +
  geom_bar(stat = "identity", position = "dodge") +
  ggtitle("Grant Duration by Institution") +
  xlab("") +
  ylab("Grant Duration (Years)") +
  scale_fill_manual(values = my_colors) +  # Apply custom colors
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 12),  # Adjust size of x-axis labels
        axis.text.y = element_text(size = 12),  # Adjust size of y-axis labels
        legend.text = element_text(size = 12),  # Adjust size of legend text
        plot.title = element_text(hjust = 0.5, size = 14))  # Adjust size of plot title

```

**Figure 5:**

**NSF**

```{r}
# COMPARISON BETWEEEN NSF - Grant Duration

library(readxl)

NSF_Compare_Data <- read_xlsx("NSF_Combined_Data.xlsx")

library(dplyr)

# Filter the data for each institution
UI_NSF_data <- NSF_Compare_Data %>%
  filter(Organization == "Regents of the University of Idaho")

BSU_NSF_data <- NSF_Compare_Data %>%
  filter(Organization == "Boise State University")

ISU_NSF_data <- NSF_Compare_Data %>%
  filter(Organization == "Idaho State University")

# Calculate the duration of grants for each institution
# Convert "Start Date" and "End Date" columns to date objects
#UI

UI_NSF_data <- UI_NSF_data %>%
  mutate(`Start Date` = as.Date(StartDate, format = "%m/%d/%Y"),
         `End Date` = as.Date(EndDate, format = "%m/%d/%Y"))

# Assuming 'grant_duration' is in days
UI_NSF_data <- UI_NSF_data %>%
  mutate(grant_duration = `End Date` - `Start Date`)

UI_NSF_data <- UI_NSF_data %>%
  mutate(grant_duration_years = as.numeric(grant_duration) / 365.25)

# BSU
BSU_NSF_data  <- BSU_NSF_data %>%
  mutate(`Start Date` = as.Date(StartDate, format = "%m/%d/%Y"),
         `End Date` = as.Date(EndDate, format = "%m/%d/%Y"))

# Assuming 'grant_duration' is in days
BSU_NSF_data  <- BSU_NSF_data %>%
  mutate(grant_duration = `End Date` - `Start Date`)

BSU_NSF_data  <- BSU_NSF_data  %>%
  mutate(grant_duration_years = as.numeric(grant_duration) / 365.25)

# ISU
ISU_NSF_data<- ISU_NSF_data %>%
  mutate(`Start Date` = as.Date(StartDate, format = "%m/%d/%Y"),
         `End Date` = as.Date(EndDate, format = "%m/%d/%Y"))

# Assuming 'grant_duration' is in days
ISU_NSF_data <- ISU_NSF_data %>%
  mutate(grant_duration = `End Date` - `Start Date`)

ISU_NSF_data <- ISU_NSF_data %>%
  mutate(grant_duration_years = as.numeric(grant_duration) / 365.25)

# Visualization

library(dplyr)

# Assuming UI_data contains the grant duration information for one institution
# and other_datasets contain the grant duration information for the other institutions

# Combine datasets
combined_data_NSF <- bind_rows(UI_NSF_data, BSU_NSF_data, ISU_NSF_data)

# Colors

my_colors <- c("Boise State University" = "orange", "Idaho State University" = "black", "Regents of the University of Idaho" = "gold")

# Plotting grant duration as a bar graph
library(ggplot2)

ggplot(combined_data_NSF, aes(x = Organization, y = grant_duration_years, fill = Organization)) +
  geom_bar(stat = "identity", position = "dodge") +
  ggtitle("Grant Duration by Organization") +
  xlab("") +
  ylab("Grant Duration (Years)") +
  scale_fill_manual(values = my_colors) +  # Apply custom colors
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 12),  # Adjust size of x-axis labels
        axis.text.y = element_text(size = 12),  # Adjust size of y-axis labels
        legend.text = element_text(size = 12),  # Adjust size of legend text
        plot.title = element_text(hjust = 0.5, size = 14))  # Adjust size of plot title
```

**Figure 6:**

**NIH**

```{r}
# COMPARISON BETWEEEN NIH - Grant Duration

library(readxl)

NIH_Compare_Data <- read_xlsx("NIH_Combined_Data.xlsx")

library(dplyr)

# Filter the data for each institution
UI_NIH_data <- NIH_Compare_Data %>%
  filter(OrganizationName == "UNIVERSITY OF IDAHO")

BSU_NIH_data <- NIH_Compare_Data %>%
  filter(OrganizationName == "BOISE STATE UNIVERSITY")

ISU_NIH_data <- NIH_Compare_Data %>%
  filter(OrganizationName == "IDAHO STATE UNIVERSITY")

# Calculate the duration of grants for each institution
# Convert "Start Date" and "End Date" columns to date objects
#UI

UI_NIH_data <- UI_NIH_data%>%
  mutate(`Start Date` = as.Date(ProjectStartDate, format = "%m/%d/%Y"),
         `End Date` = as.Date(ProjectEndDate, format = "%m/%d/%Y"))

# Assuming 'grant_duration' is in days
UI_NIH_data <- UI_NIH_data %>%
  mutate(grant_duration = `End Date` - `Start Date`)

UI_NIH_data <- UI_NIH_data %>%
  mutate(grant_duration_years = as.numeric(grant_duration) / 365.25)

# BSU - no quiere funcionar no tengo la menor idea pq
BSU_NIH_data  <- BSU_NIH_data %>%
  mutate(`Start Date` = as.Date(ProjectStartDate, format = "%m/%d/%Y"),
         `End Date` = as.Date(ProjectEndDate, format = "%m/%d/%Y"))

# Assuming 'grant_duration' is in days
BSU_NIH_data  <- BSU_NIH_data %>%
  mutate(grant_duration = `End Date` - `Start Date`)

BSU_NIH_data  <- BSU_NIH_data  %>%
  mutate(grant_duration_years = as.numeric(grant_duration) / 365.25)

# ISU
ISU_NIH_data<- ISU_NIH_data %>%
  mutate(`Start Date` = as.Date(ProjectStartDate, format = "%m/%d/%Y"),
         `End Date` = as.Date(ProjectEndDate, format = "%m/%d/%Y"))

# Assuming 'grant_duration' is in days
ISU_NIH_data <- ISU_NIH_data %>%
  mutate(grant_duration = `End Date` - `Start Date`)

ISU_NIH_data <- ISU_NIH_data %>%
  mutate(grant_duration_years = as.numeric(grant_duration) / 365.25)

# Visualization

library(dplyr)

# Assuming UI_data contains the grant duration information for one institution
# and other_datasets contain the grant duration information for the other institutions

# Combine datasets
combined_data_NIH <- bind_rows(UI_NIH_data, BSU_NIH_data, ISU_NIH_data)

# Colors

my_colors_3 <- c("BOISE STATE UNIVERSITY" = "orange", "IDAHO STATE UNIVERSITY" = "black", "UNIVERSITY OF IDAHO" = "gold")

# Plotting grant duration as a bar graph
library(ggplot2)

ggplot(combined_data_NIH, aes(x = OrganizationName, y = grant_duration_years, fill = OrganizationName)) +
  geom_bar(stat = "identity", position = "dodge") +
  ggtitle("Grant Duration by Organization") +
  xlab("") +
  ylab("Grant Duration (Years)") +
  scale_fill_manual(values = my_colors_3) +  # Apply custom colors
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 12),  # Adjust size of x-axis labels
        axis.text.y = element_text(size = 12),  # Adjust size of y-axis labels
        legend.text = element_text(size = 12),  # Adjust size of legend text
        plot.title = element_text(hjust = 0.5, size = 14))  # Adjust size of plot title
```

**Figure 7:**

### Data Comparison of Grant Status

**DOE**

```{r}
# COMPARISON BETWEEEN DOE - Grant Status
library(dplyr)
library(ggplot2)

# Calculate total grant action count for each institution
DOE_Grant_Action <- DOE_Compare_Data %>%
  group_by(Institution, `Action Type`) %>%
  summarise(count = n(), .groups = "drop") %>%
  ungroup()

library(ggplot2)

# Assuming DOE_Grant_Action is your summarized data frame with counts of Action Type by Institution

ggplot(DOE_Grant_Action, aes(x = Institution, y = count, fill = `Action Type`)) +
  geom_bar(stat = "identity", position = "dodge") +
  ggtitle("Number of Counts of Action Type by Institution") +
  xlab("") +
  ylab("Number of Active Grants") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 12),  # Adjust size of x-axis labels
        axis.text.y = element_text(size = 12),  # Adjust size of y-axis labels
        legend.text = element_text(size = 12),  # Adjust size of legend text
        plot.title = element_text(hjust = 0.5, size = 14))
```

**Figure 8:**

**NSF**

```{r}
# COMPARISON BETWEEEN NSF - Grant Status
library(dplyr)
library(ggplot2)

# Calculate total grant action count for each institution
NSF_Grant_Award_Instrument <- NSF_Compare_Data %>%
  group_by(Organization, AwardInstrument) %>%
  summarise(count = n(), .groups = "drop") %>%
  ungroup()

# Check unique levels of AwardInstrument
unique_levels <- unique(NSF_Grant_Award_Instrument$AwardInstrument)

# Adjust my_colors_4 to match the number of unique levels
my_colors_4 <- c("navyblue", "darkgreen", "darkorange", "darkred")  # or any other color palette you prefer

# Plot with adjusted colors
ggplot(NSF_Grant_Award_Instrument, aes(x = Organization, y = count, fill = AwardInstrument)) +
  geom_bar(stat = "identity", position = "dodge") +
  ggtitle("Number of Counts of Action Type by Institution") +
  xlab("") +
  ylab("Number of Active Grants") +
  scale_fill_manual(values = my_colors_4) +  # Add this line to set custom colors
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 12),  
        axis.text.y = element_text(size = 12),  
        legend.text = element_text(size = 12),  
        plot.title = element_text(hjust = 0.5, size = 14))
```

**Figure 9:**



## CONLUSIONS/SUMMARY
